----------------------------------------------------
-- Enlightenment Era (Vox Populi)
-- TECHNOLOGIES
-- 2018-01-30 Reworked by Infixo from EE & VP-EE mods
-- 2018-02-03 Infixo: Optimized tech tree updates
-- 2022-08-19 CAYM: Optimized tech tree updates, KR patch
-- 2023-08-24 CAYM: Optimized tech tree updates, KR patch + tree modified
-- 2023-11-06 Updated by CAYM to be compatible with VP 4.2.7
----------------------------------------------------

-- Make space for EE techs
UPDATE Technologies SET GridX = 20 WHERE GridX = 18; -- Future Tech
UPDATE Technologies SET GridX = 19 WHERE GridX = 17; -- INF3
UPDATE Technologies SET GridX = 18 WHERE GridX = 16; -- INF2
UPDATE Technologies SET GridX = 17 WHERE GridX = 15; -- INF1
UPDATE Technologies SET GridX = 16 WHERE GridX = 14; -- ATO2
UPDATE Technologies SET GridX = 15 WHERE GridX = 13; -- ATO1
UPDATE Technologies SET GridX = 14 WHERE GridX = 12; -- MOD2
UPDATE Technologies SET GridX = 13 WHERE GridX = 11; -- MOD1

INSERT INTO Technologies (Type, Description, Civilopedia, Help, Era, Trade, GridX, GridY, Quote, PortraitIndex, IconAtlas, AudioIntro, AudioIntroHeader) VALUES
('TECH_EE_SOVEREIGNTY',  'TXT_KEY_TECH_EE_SOVEREIGNTY',  'TXT_KEY_TECH_EE_SOVEREIGNTY_DESC',  'TXT_KEY_TECH_EE_SOVEREIGNTY_HELP',  'ERA_ENLIGHTENMENT',  1,  9, 1, 'TXT_KEY_TECH_EE_SOVEREIGNTY_QUOTE',  2, 'ENLIGHTENMENT_TECH_ATLAS', 'AS2D_TECH_EE_SOVEREIGNTY',  'AS2D_TECH_EE_SOVEREIGNTY'),
('TECH_EE_EXPLORATION',  'TXT_KEY_TECH_EE_EXPLORATION',  'TXT_KEY_TECH_EXPLORATION_DESC',     'TXT_KEY_TECH_EE_EXPLORATION_HELP',  'ERA_RENAISSANCE',  1,  8, 7, 'TXT_KEY_TECH_EE_EXPLORATION_QUOTE',  1, 'ENLIGHTENMENT_TECH_ATLAS', 'AS2D_TECH_MED_EXPLORATION', 'AS2D_TECH_MED_EXPLORATION'),
('TECH_EE_HUMANISM',     'TXT_KEY_TECH_EE_HUMANISM',     'TXT_KEY_TECH_HUMANISM_DESC',        'TXT_KEY_TECH_EE_HUMANISM_HELP',     'ERA_RENAISSANCE',1,  8, 1, 'TXT_KEY_TECH_EE_HUMANISM_QUOTE',     6, 'ENLIGHTENMENT_TECH_ATLAS', 'AS2D_TECH_EE_HUMANISM',     'AS2D_TECH_EE_HUMANISM'),
('TECH_EE_FLINTLOCK',    'TXT_KEY_TECH_EE_FLINTLOCK',    'TXT_KEY_TECH_EE_FLINTLOCK_DESC',    'TXT_KEY_TECH_EE_FLINTLOCK_HELP',    'ERA_ENLIGHTENMENT',1,  9, 9, 'TXT_KEY_TECH_EE_FLINTLOCK_QUOTE',    0, 'CIVIL_WAR_RESOURCE_ATLAS_EXP2','AS2D_TECH_EE_FLINTLOCK','AS2D_TECH_EE_FLINTLOCK'),
('TECH_EE_MANUFACTURING','TXT_KEY_TECH_EE_MANUFACTURING','TXT_KEY_TECH_EE_MANUFACTURING_DESC','TXT_KEY_TECH_EE_MANUFACTURING_HELP','ERA_ENLIGHTENMENT',1, 10, 6, 'TXT_KEY_TECH_EE_MANUFACTURING_QUOTE',7, 'ENLIGHTENMENT_TECH_ATLAS', 'AS2D_TECH_EE_MANUFACTURING','AS2D_TECH_EE_MANUFACTURING'),
('TECH_EE_WARSHIPS',     'TXT_KEY_TECH_EE_WARSHIPS',     'TXT_KEY_TECH_EE_WARSHIPS_DESC',     'TXT_KEY_TECH_EE_WARSHIPS_HELP',     'ERA_ENLIGHTENMENT',1, 10, 8, 'TXT_KEY_TECH_EE_WARSHIPS_QUOTE',     4, 'TECH_ATLAS_DLC_07',        'AS2D_TECH_WARSHIPS',        'AS2D_TECH_WARSHIPS'),
('TECH_EE_FORTIFICATION','TXT_KEY_TECH_EE_FORTIFICATION','TXT_KEY_TECH_EE_FORTIFICATION_DESC','TXT_KEY_TECH_EE_FORTIFICATION_HELP','ERA_ENLIGHTENMENT',1, 9, 5, 'TXT_KEY_TECH_EE_FORTIFICATION_QUOTE',3, 'ENLIGHTENMENT_TECH_ATLAS', 'AS2D_TECH_EE_FORTIFICATION','AS2D_TECH_EE_FORTIFICATION'),
('TECH_EE_ROMANTICISM',  'TXT_KEY_TECH_EE_ROMANTICISM',  'TXT_KEY_TECH_EE_ROMANTICISM_DESC',  'TXT_KEY_TECH_EE_ROMANTICISM_HELP',  'ERA_INDUSTRIAL',   1, 11, 2, 'TXT_KEY_TECH_EE_ROMANTICISM_QUOTE',  5, 'ENLIGHTENMENT_TECH_ATLAS', 'AS2D_TECH_EE_ROMANTICISM',  'AS2D_TECH_EE_ROMANTICISM'),
('TECH_EE_REFRACTION',  'TXT_KEY_TECH_EE_REFRACTION',  'TXT_KEY_TECH_EE_REFRACTION_DESC',  'TXT_KEY_TECH_EE_REFRACTION_HELP',  'ERA_ENLIGHTENMENT',   1, 8, 5, 'TXT_KEY_TECH_EE_REFRACTION_QUOTE',  34, 'TECH_ATLAS_1', 'AS2D_TECH_EE_REFRACTION',  'AS2D_TECH_EE_REFRACTION');

UPDATE Technologies SET IconAtlas = 'ENLIGHTENMENT_TECH_ATLAS', PortraitIndex = 8 WHERE Type = 'TECH_ASTRONOMY';

INSERT INTO Improvement_TechYieldChanges
	(ImprovementType, TechType, YieldType, Yield)
VALUES
	('IMPROVEMENT_CAMP', 'TECH_EE_FLINTLOCK', 'YIELD_GOLD', 1),
	('IMPROVEMENT_FORT', 'TECH_EE_FORTIFICATION', 'YIELD_FOOD', 1);

-- Manufactory 
UPDATE Improvement_TechYieldChanges SET TechType = 'TECH_EE_MANUFACTURING' WHERE ImprovementType = 'IMPROVEMENT_MANUFACTORY' AND TechType = 'TECH_FERTILIZER';
-- Town earlier since acoustics is bare and railroad is wildly overbudget
UPDATE Improvement_TechYieldChanges SET TechType = 'TECH_ACOUSTICS' WHERE ImprovementType = 'IMPROVEMENT_CUSTOMS_HOUSE' AND TechType = 'TECH_RAILROAD';
-- village same reason
UPDATE Improvement_TechYieldChanges SET TechType = 'TECH_EE_ROMANTICISM' WHERE ImprovementType = 'IMPROVEMENT_TRADING_POST' AND TechType = 'TECH_RAILROAD';
-- quarry earlier because they are bunched and we have space now
UPDATE Improvement_TechYieldChanges SET TechType = 'TECH_EE_REFRACTION' WHERE ImprovementType = 'IMPROVEMENT_QUARRY' AND TechType = 'TECH_STEAM_POWER';

UPDATE Technologies SET EmbarkedMoveChange = 1 WHERE Type = 'TECH_EE_EXPLORATION';
UPDATE Technologies SET EmbarkedMoveChange = 0 WHERE Type = 'TECH_ASTRONOMY';

UPDATE Technologies SET InternationalTradeRoutesChange = 1 WHERE Type = 'TECH_EE_EXPLORATION';
UPDATE Technologies SET InternationalTradeRoutesChange = 0 WHERE Type = 'TECH_ECONOMICS';
UPDATE Technologies SET InternationalTradeRoutesChange = 1 WHERE Type = 'TECH_EE_WARSHIPS';

-- and tech trade at navigation. it's so late (both now and when we set it back 2 columns)
UPDATE Technologies SET MapTrading = 0 WHERE Type = 'TECH_MILITARY_SCIENCE';
UPDATE Technologies SET MapTrading = 1 WHERE Type = 'TECH_NAVIGATION';

UPDATE Technologies SET IconAtlas = 'ENLIGHTENMENT_TECH_ATLAS', PortraitIndex = 0 WHERE Type = 'TECH_ARCHAEOLOGY';

DELETE FROM Tech_SpecialistYieldChanges WHERE TechType = 'TECH_NAVIGATION' AND SpecialistType = 'SPECIALIST_CIVIL_SERVANT';
UPDATE Tech_SpecialistYieldChanges SET Yield = 1 WHERE TechType = 'TECH_INDUSTRIALIZATION' AND SpecialistType = 'SPECIALIST_ENGINEER';

INSERT INTO Tech_SpecialistYieldChanges 
	(TechType, SpecialistType, YieldType, Yield)
VALUES
	('TECH_EE_HUMANISM',	  'SPECIALIST_WRITER',	      'YIELD_CULTURE', 1),
	('TECH_EE_ROMANTICISM',   'SPECIALIST_MUSICIAN',      'YIELD_CULTURE', 1),
	('TECH_EE_ROMANTICISM',	  'SPECIALIST_ARTIST',	      'YIELD_CULTURE', 1),
	('TECH_EE_SOVEREIGNTY',	  'SPECIALIST_CIVIL_SERVANT', 'YIELD_CULTURE', 1),
	('TECH_BANKING',	  'SPECIALIST_CIVIL_SERVANT', 'YIELD_GOLD', 1),
	('TECH_EE_FORTIFICATION', 'SPECIALIST_ENGINEER',      'YIELD_PRODUCTION', 1),
	('TECH_ELECTRICITY',	  'SPECIALIST_SCIENTIST',     'YIELD_SCIENCE', 1),  -- should move this elsewhere but i wont delete it so i remember
	('TECH_EE_HUMANISM',	  'SPECIALIST_CITIZEN',       'YIELD_FAITH', 1),
	('TECH_EE_REFRACTION',	  'SPECIALIST_CITIZEN',       'YIELD_FOOD', 1),
	('TECH_EE_FLINTLOCK',	  'SPECIALIST_CITIZEN',       'YIELD_CULTURE', 1),
	('TECH_EE_SOVEREIGNTY',   'SPECIALIST_CITIZEN',       'YIELD_SCIENCE', 1);

--==========================================================================================================================
-- Technology Tree
--==========================================================================================================================
-- Grid X=7 (RE)
UPDATE Technologies SET GridX = 7, GridY = 1 WHERE Type = 'TECH_PRINTING_PRESS';
UPDATE Technologies SET GridX = 7, GridY = 3 WHERE Type = 'TECH_BANKING';

-- Grid X=8 (RE)
UPDATE Technologies SET GridX = 8, GridY = 3 WHERE Type = 'TECH_ARCHITECTURE';

-- Grid X=9 (EE)
UPDATE Technologies SET Era = 'ERA_ENLIGHTENMENT', GridX = 9, GridY = 3 WHERE Type = 'TECH_ECONOMICS';
UPDATE Technologies SET Era = 'ERA_ENLIGHTENMENT', GridX = 9, GridY = 7 WHERE Type = 'TECH_NAVIGATION';

-- Grid X=10 (EE)
UPDATE Technologies SET Era = 'ERA_ENLIGHTENMENT', GridX = 10, GridY = 2 WHERE Type = 'TECH_ACOUSTICS';
UPDATE Technologies SET Era = 'ERA_ENLIGHTENMENT', GridX = 10, GridY = 4 WHERE Type = 'TECH_SCIENTIFIC_THEORY';

-- Grid X=11 (IND)
UPDATE Technologies SET Era = 'ERA_INDUSTRIAL', GridX = 11, GridY = 4 WHERE Type = 'TECH_RAILROAD';
UPDATE Technologies SET Era = 'ERA_INDUSTRIAL', GridX = 11, GridY = 6 WHERE Type = 'TECH_STEAM_POWER';
UPDATE Technologies SET Era = 'ERA_INDUSTRIAL', GridX = 11, GridY = 8 WHERE Type = 'TECH_RIFLING';

UPDATE Technologies SET Era = 'ERA_INDUSTRIAL', GridX = 12, GridY = 1 WHERE Type = 'TECH_ARCHAEOLOGY';
UPDATE Technologies SET Era = 'ERA_INDUSTRIAL', GridX = 12, GridY = 3 WHERE Type = 'TECH_FERTILIZER';
UPDATE Technologies SET Era = 'ERA_INDUSTRIAL', GridX = 12, GridY = 5 WHERE Type = 'TECH_INDUSTRIALIZATION';
UPDATE Technologies SET Era = 'ERA_INDUSTRIAL', GridX = 12, GridY = 7 WHERE Type = 'TECH_DYNAMITE';
UPDATE Technologies SET Era = 'ERA_INDUSTRIAL', GridX = 12, GridY = 9 WHERE Type = 'TECH_MILITARY_SCIENCE';

--==========================================================================================================================
-- Prereq Technologies
--==========================================================================================================================

-- before renaissance
DELETE FROM Technology_PrereqTechs WHERE TechType = 'TECH_PRINTING_PRESS' AND PrereqTech = 'TECH_GUILDS';
DELETE FROM Technology_PrereqTechs WHERE TechType = 'TECH_GUNPOWDER' AND PrereqTech = 'TECH_COMPASS';

INSERT INTO Technology_PrereqTechs 
	(TechType, PrereqTech)
VALUES
	('TECH_BANKING', 'TECH_GUILDS'),
	('TECH_GUNPOWDER', 'TECH_COMPASS');

-- Grid X=8 (REN)
DELETE FROM Technology_PrereqTechs WHERE TechType = 'TECH_ARCHITECTURE';
DELETE FROM Technology_PrereqTechs WHERE TechType = 'TECH_ECONOMICS';

INSERT INTO Technology_PrereqTechs (TechType, PrereqTech)
VALUES
	('TECH_EE_HUMANISM', 'TECH_PRINTING_PRESS'),
	('TECH_EE_HUMANISM', 'TECH_BANKING'),
	('TECH_ARCHITECTURE', 'TECH_BANKING'),
	('TECH_ARCHITECTURE', 'TECH_PRINTING_PRESS'),
	('TECH_ARCHITECTURE', 'TECH_ASTRONOMY'),
	('TECH_EE_REFRACTION', 'TECH_BANKING'),
	('TECH_EE_REFRACTION', 'TECH_GUNPOWDER'),
	('TECH_EE_REFRACTION', 'TECH_ASTRONOMY'),
	('TECH_EE_EXPLORATION', 'TECH_ASTRONOMY'),
	('TECH_EE_EXPLORATION', 'TECH_GUNPOWDER'),
	('TECH_EE_EXPLORATION', 'TECH_CHEMISTRY');

-- Grid X=9 (EE)
DELETE FROM Technology_PrereqTechs WHERE TechType = 'TECH_NAVIGATION';

INSERT INTO Technology_PrereqTechs (TechType, PrereqTech)
VALUES
	('TECH_EE_SOVEREIGNTY', 'TECH_EE_HUMANISM'),
	('TECH_EE_SOVEREIGNTY', 'TECH_ARCHITECTURE'),
	('TECH_ECONOMICS', 'TECH_EE_HUMANISM'),
	('TECH_ECONOMICS', 'TECH_ARCHITECTURE'),
	('TECH_ECONOMICS', 'TECH_EE_REFRACTION'),
	('TECH_EE_FORTIFICATION', 'TECH_EE_REFRACTION'),
	('TECH_EE_FORTIFICATION', 'TECH_EE_EXPLORATION'),	
	('TECH_EE_FORTIFICATION', 'TECH_ARCHITECTURE'),
	('TECH_NAVIGATION', 'TECH_EE_REFRACTION'),
	('TECH_NAVIGATION', 'TECH_METALLURGY'),
	('TECH_NAVIGATION', 'TECH_EE_EXPLORATION'),
	('TECH_EE_FLINTLOCK', 'TECH_EE_EXPLORATION'),
	('TECH_EE_FLINTLOCK', 'TECH_METALLURGY');

-- Grid X=10 (EE)
DELETE FROM Technology_PrereqTechs WHERE TechType = 'TECH_SCIENTIFIC_THEORY';
DELETE FROM Technology_PrereqTechs WHERE TechType = 'TECH_ACOUSTICS';

INSERT INTO Technology_PrereqTechs (TechType, PrereqTech)
VALUES
	('TECH_ACOUSTICS', 'TECH_ECONOMICS'),
	('TECH_ACOUSTICS', 'TECH_EE_SOVEREIGNTY'),
	('TECH_SCIENTIFIC_THEORY', 'TECH_EE_FORTIFICATION'),
	('TECH_SCIENTIFIC_THEORY', 'TECH_ECONOMICS'),
	('TECH_EE_MANUFACTURING', 'TECH_EE_FORTIFICATION'),
	('TECH_EE_MANUFACTURING', 'TECH_NAVIGATION'),
	('TECH_EE_WARSHIPS', 'TECH_NAVIGATION'),
	('TECH_EE_WARSHIPS', 'TECH_EE_FLINTLOCK');

-- Grid X=11 (IND)
DELETE FROM Technology_PrereqTechs WHERE TechType IN (
	'TECH_RAILROAD',
	'TECH_STEAM_POWER',
	'TECH_RIFLING');

INSERT INTO Technology_PrereqTechs (TechType, PrereqTech)
VALUES
	('TECH_EE_ROMANTICISM', 'TECH_SCIENTIFIC_THEORY'),
	('TECH_EE_ROMANTICISM', 'TECH_ACOUSTICS'),
	('TECH_RAILROAD', 'TECH_SCIENTIFIC_THEORY'),
	('TECH_RAILROAD', 'TECH_EE_MANUFACTURING'),
	('TECH_RAILROAD', 'TECH_ACOUSTICS'),
	('TECH_STEAM_POWER', 'TECH_EE_MANUFACTURING'),	
	('TECH_STEAM_POWER', 'TECH_SCIENTIFIC_THEORY'),
	('TECH_STEAM_POWER', 'TECH_EE_WARSHIPS'),
	('TECH_RIFLING', 'TECH_EE_MANUFACTURING'),
	('TECH_RIFLING', 'TECH_EE_WARSHIPS');

-- Grid X=12 (IND)
DELETE FROM Technology_PrereqTechs WHERE TechType = 'TECH_ARCHAEOLOGY';
DELETE FROM Technology_PrereqTechs WHERE TechType = 'TECH_FERTILIZER';

INSERT INTO Technology_PrereqTechs (TechType, PrereqTech)
VALUES
	('TECH_ARCHAEOLOGY', 'TECH_EE_ROMANTICISM'),
	('TECH_FERTILIZER', 'TECH_EE_ROMANTICISM'),
	('TECH_FERTILIZER', 'TECH_RAILROAD');

--==========================================================================================================================
-- Flavors
--==========================================================================================================================

INSERT INTO Technology_Flavors (TechType, FlavorType, Flavor)
VALUES
	('TECH_EE_EXPLORATION', 'FLAVOR_RECON', 10),
	('TECH_EE_EXPLORATION', 'FLAVOR_NAVAL_RECON', 10),
	('TECH_EE_EXPLORATION', 'FLAVOR_GOLD', 5),
	('TECH_EE_EXPLORATION', 'FLAVOR_WATER_CONNECTION', 10),
	('TECH_EE_FLINTLOCK', 'FLAVOR_SCIENCE', 8),
	('TECH_EE_FLINTLOCK', 'FLAVOR_DEFENSE', 10),
	('TECH_EE_FLINTLOCK', 'FLAVOR_OFFENSE', 10),
	('TECH_EE_FLINTLOCK', 'FLAVOR_MILITARY_TRAINING', 3),
	('TECH_EE_FLINTLOCK', 'FLAVOR_RANGED', 15),
	('TECH_EE_FORTIFICATION', 'FLAVOR_WONDER', 2),
	('TECH_EE_FORTIFICATION', 'FLAVOR_CITY_DEFENSE', 5),
	('TECH_EE_FORTIFICATION', 'FLAVOR_SCIENCE', 5),
	('TECH_EE_FORTIFICATION', 'FLAVOR_RANGED', 8),
	('TECH_EE_HUMANISM', 'FLAVOR_SCIENCE', 10),
	('TECH_EE_HUMANISM', 'FLAVOR_WONDER', 4),
	('TECH_EE_HUMANISM', 'FLAVOR_CULTURE', 10),
	('TECH_EE_REFRACTION', 'FLAVOR_SCIENCE', 10),
	('TECH_EE_REFRACTION', 'FLAVOR_WONDER', 4),
	('TECH_EE_REFRACTION', 'FLAVOR_NAVAL_GROWTH', 10),
	('TECH_EE_MANUFACTURING', 'FLAVOR_EXPANSION', 5),
	('TECH_EE_MANUFACTURING', 'FLAVOR_GROWTH', 10),
	('TECH_EE_MANUFACTURING', 'FLAVOR_PRODUCTION', 10),
	('TECH_EE_MANUFACTURING', 'FLAVOR_TILE_IMPROVEMENT', 2),
	('TECH_EE_ROMANTICISM', 'FLAVOR_CULTURE', 15),
	('TECH_EE_ROMANTICISM', 'FLAVOR_GOLD', 4),
	('TECH_EE_ROMANTICISM', 'FLAVOR_WONDER', 2),
	('TECH_EE_ROMANTICISM', 'FLAVOR_GROWTH', 2),
	('TECH_EE_SOVEREIGNTY', 'FLAVOR_DIPLOMACY', 4),
	('TECH_EE_SOVEREIGNTY', 'FLAVOR_GREAT_PEOPLE', 3),
	('TECH_EE_SOVEREIGNTY', 'FLAVOR_PRODUCTION', 3),
	('TECH_EE_SOVEREIGNTY', 'FLAVOR_WONDER', 5),
	('TECH_EE_WARSHIPS', 'FLAVOR_NAVAL', 15),
	('TECH_EE_WARSHIPS', 'FLAVOR_MILITARY_TRAINING', 3),
	('TECH_EE_WARSHIPS', 'FLAVOR_NAVAL_RECON', 5),
	('TECH_EE_WARSHIPS', 'FLAVOR_CITY_DEFENSE', 5),
	('TECH_EE_WARSHIPS', 'FLAVOR_WONDER', 2),
	('TECH_EE_WARSHIPS', 'FLAVOR_NAVAL_GROWTH', 5);

--==========================================================================================================================
-- Costs
--==========================================================================================================================
CREATE TEMP TABLE TechCosts (
	X INTEGER,
	TechCost INTEGER
);

INSERT INTO TechCosts
VALUES
	(0, 20),
	(1, 60),
	(2, 100),
	(3, 130),
	(4, 275),
	(5, 500),
	(6, 700),
	(7, 1750),
	(8, 2400),
	(9, 3600),
	(10, 5000),
	(11, 7400),
	(12, 9800),
	(13, 12000),
	(14, 14000),
	(15, 17100),
	(16, 20400),
	(17, 24500),  -- linear extrapolation
	(18, 27500),
	(19, 29000),
	(20, 31000);

UPDATE Technologies
SET Cost = (SELECT TechCost FROM TechCosts WHERE X = GridX)
WHERE EXISTS (SELECT 1 FROM TechCosts WHERE X = GridX);

DROP TABLE TechCosts;
